% header.tex - LaTeX packages for Quantum Zero-Knowledge Proofs
\usepackage{amsmath,amssymb}
\usepackage{braket}
\usepackage{needspace}
\usepackage{fontspec}
\usepackage{unicode-math}

% Font configuration
\setmainfont{Times New Roman}[
  Ligatures=TeX,
  Numbers=OldStyle
]
\setsansfont{Helvetica Neue}[
  Scale=MatchLowercase,
  Ligatures=TeX
]
\setmonofont{Menlo}[
  Scale=MatchLowercase
]

% Math font with Unicode support
\setmathfont{Latin Modern Math}
\setmathfont[range={\mathup/{greek,Greek}}]{Arial Unicode MS}
\setmathfont[range={\mathit/{greek,Greek}}]{Arial Unicode MS}

% Unicode character mappings for quantum notation
\usepackage{newunicodechar}
\newunicodechar{⟩}{\ensuremath{\rangle}}
\newunicodechar{⟨}{\ensuremath{\langle}}
\newunicodechar{ψ}{\ensuremath{\psi}}
\newunicodechar{λ}{\ensuremath{\lambda}}
\newunicodechar{ε}{\ensuremath{\varepsilon}}
\newunicodechar{≥}{\ensuremath{\geq}}
\newunicodechar{≤}{\ensuremath{\leq}}
\newunicodechar{×}{\ensuremath{\times}}
\newunicodechar{−}{\ensuremath{-}}

% Improved spacing and typography
\usepackage{microtype}
\usepackage{setspace}
\setstretch{1.15}

% Better paragraph spacing
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\parindent}{0pt}

% Section spacing improvements with selective page breaks
\usepackage{titlesec}
% Only main sections (1, 2, 3, etc.) start on new pages, not subsections (1.1, 2.1, etc.)
\titleformat{\section}[display]
  {\normalfont\Large\bfseries}{\thesection}{20pt}{\Large}
\titlespacing*{\section}{0pt}{0pt}{20pt}

% Subsections stay on same page with normal spacing
\titlespacing{\subsection}{0pt}{14pt plus 3pt minus 2pt}{6pt plus 2pt minus 1pt}
\titlespacing{\subsubsection}{0pt}{12pt plus 3pt minus 2pt}{4pt plus 2pt minus 1pt}

% Custom command to force page breaks before main sections only
\let\oldsection\section
\renewcommand{\section}{\clearpage\oldsection}

% Better table and figure spacing
\setlength{\floatsep}{12pt plus 2pt minus 2pt}
\setlength{\textfloatsep}{16pt plus 2pt minus 4pt}
\setlength{\intextsep}{12pt plus 2pt minus 2pt}

% Prevent page breaks in code blocks and tables
\usepackage{fvextra}
\usepackage{longtable}
\usepackage{array}

% Keep code blocks together
\fvset{breaklines=true,breakanywhere=true}

% Prevent orphans and widows
\widowpenalty=10000
\clubpenalty=10000

% Keep tables together
\usepackage{float}
\restylefloat{table}

